{% extends "base.html" %}

{% block title %}View Accident Log{% endblock %}

{% block content %}

{% if current_user.is_authenticated %}
          <div class="user-info">
            You are logged in as {{ current_user.firstname }}
            <form action="{{ url_for('logout') }}" method="post" style="display:inline;">
            <button type="submit">Logout</button>
             </form>
         </div>
        {% endif %}

<h2>Logs and Registry</h2>

{% if accidents %}
<h3>Accident Logs</h3>
    <table class="table-wrapper">
        <thead>
            <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Description</th>
                <th>Location</th>
                <th>Date</th>
                <th>Time</th>
                <th>First Aid Given</th>
                <th>First Aider</th>
                <th>First Aid Details</th>
                <th>Reported By</th>
                <th> </th>
            </tr>
        </thead>
        <tbody>
            {% for accident in accidents %}
            <tr>
                <td>{{ accident.title }}</td>
                <td>{{ accident.type }}</td>
                <td>{{ accident.description }}</td>
                <td>{{ accident.location }}</td>
                <td>{{ accident.date_of_accident.strftime('%Y-%m-%d') }}</td>
                <td>{{ accident.time_of_accident.strftime('%H:%M') }}</td>
                <td>{{ 'Yes' if accident.first_aid_administered else 'No' }}</td>
                <td>
                    {% if accident.first_aider %}
                        {{ accident.first_aider.firstname }} {{ accident.first_aider.surname }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ accident.first_aid_details }}</td>
                <td>{{ accident.reporter.firstname }} {{ accident.reporter.surname }}</td>
                <td>
                <a href="{{ url_for('edit_accident', accident_id=accident.id) }}">Edit</a> |
                <form method="POST" action="{{ url_for('delete_accident', accident_id=accident.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this accident?');">
                    <button type="submit">Delete</button>
                </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
<p>To view First Aider's Registry <a href="{{ url_for('first_aider_registry') }}">Click Here</a></p>
{% else %}
    <p></p>

{% endif %}

<br>



{% if first_aiders %}
<h3>First Aider's Registry</h3>
    <table class="table-wrapper">
        <thead>
            <tr>
                <th>ID</th>
                <th>Staff Number</th>
                <th>First Name</th>
                <th>Surname</th>
                <th>Email</th>
                <th>Certificate Number</th>
            </tr>
        </thead>
        <tbody>
            {% for fa in first_aiders %}
            <tr>
                <td>{{ fa.id }}</td>
                <td>{{ fa.staffnumber }}</td>
                <td>{{ fa.firstname }}</td>
                <td>{{ fa.surname }}</td>
                <td>{{ fa.email }}</td>
                <td>{{ fa.certificate_number }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
<p>To view Accident Logs <a href="{{ url_for('view') }}">Click Here</a></p>
{% else %}
    <p></p>
{% endif %}

{% endblock %}
